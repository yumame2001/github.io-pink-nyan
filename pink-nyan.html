<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã´ã‚“ã«ã‚ƒã‚“ã¨ ãŠã¯ãªã—v2</title>
    <style>
        /* ã²ãƒ¼ã¡ã‚ƒã‚“å¥½ã¿ã®ãƒ”ãƒ³ã‚¯ã¨ä¸¸ã¿ã®ã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³ */
        body { background-color: #FFF5F7; font-family: 'Hiragino Kaku Gothic Pro', sans-serif; text-align: center; padding: 20px; margin: 0; }
        #mascot { font-size: 120px; margin: 30px 0; display: block; line-height: 1; }
        #btn-talk { 
            background: linear-gradient(135deg, #FF99CC 0%, #FF66B2 100%);
            color: white; border: none; padding: 25px 40px; 
            border-radius: 60px; font-size: 24px; cursor: pointer; 
            box-shadow: 0 6px #d63384; transition: 0.2s;
            width: 80%; max-width: 300px;
        }
        #btn-talk:active { transform: translateY(4px); box-shadow: none; }
        #status { color: #FF66B2; margin-top: 25px; font-size: 18px; font-weight: bold; min-height: 1.5em; }
        .log-box { 
            background: white; border-radius: 20px; padding: 20px; 
            margin: 20px auto; border: 2px solid #FFC0CB; 
            width: 90%; max-width: 500px; min-height: 100px;
            box-sizing: border-box; text-align: left; line-height: 1.6;
        }
    </style>
</head>
<body>

    <div id="mascot">ğŸ±</div>
    
    <h1 style="color: #FF1493; font-size: 22px;">ã²ãƒ¼ã¡ã‚ƒã‚“ã€ãªã‚“ã§ã‚‚ ãã„ã¦ã«ã‚ƒï¼</h1>
    
    <button id="btn-talk">ãŠã¯ãªã— ã™ã‚‹ï¼ˆãŠã—ã¦ã«ã‚ƒï¼‰</button>
    
    <p id="status">ãƒœã‚¿ãƒ³ã‚’ãŠã—ã¦ ã—ã‚ƒã¹ã£ã¦ã­ï¼</p>
    <div id="display-text" class="log-box">ã“ã“ã« ãŠè¿”äº‹ãŒ å‡ºã‚‹ã‚ˆ</div>

    <script>
        // ã€é‡è¦ã€‘å†ç™ºè¡Œã—ãŸAPIã‚­ãƒ¼ã‚’ã“ã“ã«å…¥ã‚Œã¦ãã ã•ã„
        const API_KEY = 'AIzaSyAhdYIr2PdHbY5hvIFMwpYYMAzaylDCZE4';

        const talkBtn = document.getElementById('btn-talk');
        const statusText = document.getElementById('status');
        const displayText = document.getElementById('display-text');

        let isRecognizing = false;

        // éŸ³å£°èªè­˜ï¼ˆè€³ï¼‰ã®è¨­å®š
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ja-JP';
        recognition.interimResults = false;

        // éŸ³å£°åˆæˆï¼ˆå£ï¼‰ã®è¨­å®š
        const synth = window.speechSynthesis;

        talkBtn.onclick = () => {
            if (isRecognizing) return;
            try {
                recognition.start();
                isRecognizing = true;
                statusText.innerText = "ãã„ã¦ã‚‹ã«ã‚ƒâ€¦â€¦ğŸ‘‚";
            } catch (e) {
                console.error("é–‹å§‹ã‚¨ãƒ©ãƒ¼:", e);
                isRecognizing = false;
            }
        };

        recognition.onend = () => { isRecognizing = false; };

        recognition.onresult = async (event) => {
            const uttr = event.results[0][0].transcript;
            statusText.innerText = "ã—ã‚‰ã¹ã¦ã‚‹ã«ã‚ƒâ€¦â€¦ğŸ”";
            displayText.innerText = "ã€Œ" + uttr + "ã€ã ã«ã‚ƒã€‚ã¡ã‚‡ã£ã¨ã¾ã£ã¦ã­â€¦";

            try {
                // v1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨
                const url = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: uttr }] }],
                        system_instruction: { 
                            parts: [{ text: "å›ã¯å…ƒæ°—ãªãƒ”ãƒ³ã‚¯ã®çŒ«ã€ã´ã‚“ã«ã‚ƒã‚“ã€ã€‚ã²ãƒ¼ã¡ã‚ƒã‚“ã®è¦ªå‹ã€‚èªå°¾ã¯ã€ã«ã‚ƒï¼ã€ã€ã«ã‚ƒã‚“ï¼ã€ã€‚å°å­¦1å¹´ç”Ÿã«ã‚ã‹ã‚‹è¨€è‘‰ã§çŸ­ãç­”ãˆã¦ã€‚ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ï¼ˆ**ãªã©ï¼‰ã¯ç¦æ­¢ã€‚" }] 
                        }
                    })
                });

                if (!response.ok) throw new Error("APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã«ã‚ƒ");

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content) {
                    const aiText = data.candidates[0].content.parts[0].text;
                    displayText.innerText = aiText;

                    const message = new SpeechSynthesisUtterance(aiText);
                    message.lang = 'ja-JP';
                    message.pitch = 1.6; // é«˜ã‚ã®ãƒã‚¹ã‚³ãƒƒãƒˆãƒœã‚¤ã‚¹
                    message.rate = 1.1;
                    synth.speak(message);
                    statusText.innerText = "ã¾ãŸ ãŠã¯ãªã— ã—ã‚ˆã†ã«ã‚ƒï¼";
                }

            } catch (error) {
                statusText.innerText = "ã‚¨ãƒ©ãƒ¼ã ã«ã‚ƒâ€¦";
                displayText.innerText = "ã”ã‚ã‚“ã­ã€ã†ã¾ãå‹•ã‹ãªã‹ã£ãŸã«ã‚ƒã€‚ã‚‚ã†ä¸€åº¦ãŸã‚ã—ã¦ã­ã€‚";
                console.error(error);
            }
        };
    </script>
</body>
</html>
