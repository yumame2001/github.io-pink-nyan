<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã´ã‚“ã«ã‚ƒã‚“ã¨ ãŠã¯ãªã—</title>
    <style>
        body { background-color: #FFF5F7; font-family: 'Hiragino Kaku Gothic Pro', sans-serif; text-align: center; padding: 20px; }
        #mascot { font-size: 120px; margin: 30px 0; display: block; }
        #btn-talk { 
            background: linear-gradient(135deg, #FF99CC 0%, #FF66B2 100%);
            color: white; border: none; padding: 25px 50px; 
            border-radius: 60px; font-size: 28px; cursor: pointer; 
            box-shadow: 0 6px #d63384; transition: 0.2s;
        }
        #btn-talk:active { transform: translateY(4px); box-shadow: none; }
        #status { color: #FF66B2; margin-top: 30px; font-size: 20px; font-weight: bold; }
        .log-box { background: white; border-radius: 15px; padding: 15px; margin-top: 20px; border: 2px solid #FFC0CB; min-height: 50px; }
    </style>
</head>
<body>
    <div id="mascot">ğŸ±</div> <h1 style="color: #FF1493;">ã²ãƒ¼ã¡ã‚ƒã‚“ã€ãªã‚“ã§ã‚‚ ãã„ã¦ã«ã‚ƒï¼</h1>
    <button id="btn-talk">ãŠã¯ãªã— ã™ã‚‹ï¼ˆãŠã—ã¦ã«ã‚ƒï¼‰</button>
    <p id="status">ãƒœã‚¿ãƒ³ã‚’ãŠã—ã¦ ã—ã‚ƒã¹ã£ã¦ã­ï¼</p>
    <div id="display-text" class="log-box">ã“ã“ã« ãŠè¿”äº‹ãŒ å‡ºã‚‹ã‚ˆ</div>

    <script>
        const API_KEY = 'AIzaSyArs_GGiSZbyDUSDzaedwANVAcXbfxLMPU';
        const talkBtn = document.getElementById('btn-talk');
        const statusText = document.getElementById('status');
        const displayText = document.getElementById('display-text');

        // éŸ³å£°èªè­˜
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ja-JP';

        // éŸ³å£°åˆæˆ
        const synth = window.speechSynthesis;

        talkBtn.onclick = () => {
            recognition.start();
            statusText.innerText = "ãã„ã¦ã‚‹ã«ã‚ƒâ€¦â€¦ğŸ‘‚";
        };

        recognition.onresult = async (event) => {
            const uttr = event.results[0][0].transcript;
            statusText.innerText = "ã—ã‚‰ã¹ã¦ã‚‹ã«ã‚ƒâ€¦â€¦ğŸ”";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: uttr }] }],
                        tools: [{ "google_search_retrieval": {} }], // æ¤œç´¢æ©Ÿèƒ½
                        system_instruction: { 
                            parts: [{ text: "å›ã¯å…ƒæ°—ãªãƒ”ãƒ³ã‚¯ã®çŒ«ã€ã´ã‚“ã«ã‚ƒã‚“ã€ã€‚ã²ãƒ¼ã¡ã‚ƒã‚“ã®è¦ªå‹ã€‚èªå°¾ã¯ã€ã«ã‚ƒï¼ã€ã€ã«ã‚ƒã‚“ï¼ã€ã€‚å°å­¦1å¹´ç”Ÿã«ã‚ã‹ã‚‹è¨€è‘‰ã§ã€Googleæ¤œç´¢ã‚’ä½¿ã£ã¦æ­£ç¢ºã«çŸ­ãç­”ãˆã¦ã€‚" }] 
                        }
                    })
                });

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                displayText.innerText = aiText;

                // èª­ã¿ä¸Šã’
                const message = new SpeechSynthesisUtterance(aiText);
                message.lang = 'ja-JP';
                message.pitch = 1.6; // çŒ«ã£ã½ãé«˜ã‚ã®å£°
                message.rate = 1.2;  // å…ƒæ°—ã«å°‘ã—é€Ÿã‚
                synth.speak(message);
                
                statusText.innerText = "ã¾ãŸ ãŠã¯ãªã— ã—ã‚ˆã†ã«ã‚ƒï¼";
            } catch (error) {
                statusText.innerText = "ã”ã‚ã‚“ã­ã€ã‚¨ãƒ©ãƒ¼ã ã«ã‚ƒâ€¦";
                console.error(error);
            }
        };
    </script>
</body>
</html>