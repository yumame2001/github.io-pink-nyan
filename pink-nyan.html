<script>
        // ã•ã£ãã‚³ãƒ”ãƒ¼ã—ãŸGASã®URLã‚’ã“ã“ã«è²¼ã‚‹
        const GAS_URL = 'https://script.google.com/macros/s/xxxxxxxxxxxxxxxxx/exec'; 

        const talkBtn = document.getElementById('btn-talk');
        const statusText = document.getElementById('status');
        const displayText = document.getElementById('display-text');
        let isRecognizing = false;

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ja-JP';
        const synth = window.speechSynthesis;

        talkBtn.onclick = () => {
            if (isRecognizing) return;
            try {
                recognition.start();
                isRecognizing = true;
                statusText.innerText = "ãã„ã¦ã‚‹ã«ã‚ƒâ€¦â€¦ğŸ‘‚";
            } catch (e) { isRecognizing = false; }
        };

        recognition.onend = () => { isRecognizing = false; };

        recognition.onresult = async (event) => {
            const uttr = event.results[0][0].transcript;
            statusText.innerText = "ã—ã‚‰ã¹ã¦ã‚‹ã«ã‚ƒâ€¦â€¦ğŸ”";

            try {
                // GASã«é€ã‚‹ï¼ˆå˜ç´”ãªPOSTé€ä¿¡ï¼‰
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ text: uttr }) // ç‰¹åˆ¥ãªãƒ˜ãƒƒãƒ€ãƒ¼ã¯ä¸è¦
                });

                const data = await response.json();
                const aiText = data.text;

                displayText.innerText = aiText;
                
                const message = new SpeechSynthesisUtterance(aiText);
                message.lang = 'ja-JP';
                message.pitch = 1.5;
                message.rate = 1.1;
                synth.speak(message);
                
                statusText.innerText = "ã¾ãŸãŠè©±ã—ã‚ˆã†ã«ã‚ƒï¼";

            } catch (error) {
                statusText.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ã ã«ã‚ƒ";
                displayText.innerText = error.message;
            }
        };
    </script>
