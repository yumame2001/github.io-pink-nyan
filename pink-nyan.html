<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã´ã‚“ã«ã‚ƒã‚“ã¨ ãŠã¯ãªã—</title>
    <style>
        body { background-color: #FFF5F7; font-family: sans-serif; text-align: center; padding: 20px; margin: 0; }
        #mascot { font-size: 100px; margin: 20px 0; line-height: 1; }
        #btn-talk { 
            background: linear-gradient(135deg, #FF99CC 0%, #FF66B2 100%);
            color: white; border: none; padding: 20px 30px; 
            border-radius: 50px; font-size: 20px; cursor: pointer; 
            box-shadow: 0 4px #d63384; width: 80%; max-width: 300px;
        }
        #status { color: #FF66B2; margin-top: 20px; font-weight: bold; }
        .log-box { 
            background: white; border-radius: 15px; padding: 15px; 
            margin: 20px auto; border: 2px solid #FFC0CB; 
            width: 90%; max-width: 500px; min-height: 80px; text-align: left;
        }
    </style>
</head>
<body>
    <div id="mascot">ğŸ±</div>
    <h1 style="color: #FF1493; font-size: 20px;">ã²ãƒ¼ã¡ã‚ƒã‚“ã€ãªã‚“ã§ã‚‚ ãã„ã¦ã«ã‚ƒï¼</h1>
    <button id="btn-talk">ãŠã¯ãªã— ã™ã‚‹ï¼ˆãŠã—ã¦ã«ã‚ƒï¼‰</button>
    <p id="status">ãƒœã‚¿ãƒ³ã‚’ãŠã—ã¦ã­</p>
    <div id="display-text" class="log-box">ãŠè¿”äº‹ãŒã“ã“ã«å‡ºã‚‹ã«ã‚ƒ</div>

    <script>
        // ã€é‡è¦ã€‘æ–°ã—ãã€Œå†ç™ºè¡Œã€ã—ãŸAPIã‚­ãƒ¼ã‚’å…¥ã‚Œã¦ãã ã•ã„
        const API_KEY = 'AIzaSyAhdYIr2PdHbY5hvIFMwpYYMAzaylDCZE4'; 

        const talkBtn = document.getElementById('btn-talk');
        const statusText = document.getElementById('status');
        const displayText = document.getElementById('display-text');
        let isRecognizing = false;

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ja-JP';
        const synth = window.speechSynthesis;

        talkBtn.onclick = () => {
            if (isRecognizing) return;
            try {
                recognition.start();
                isRecognizing = true;
                statusText.innerText = "ãã„ã¦ã‚‹ã«ã‚ƒâ€¦â€¦ğŸ‘‚";
            } catch (e) { isRecognizing = false; }
        };

        recognition.onend = () => { isRecognizing = false; };

        recognition.onresult = async (event) => {
            const uttr = event.results[0][0].transcript;
            statusText.innerText = "ã—ã‚‰ã¹ã¦ã‚‹ã«ã‚ƒâ€¦â€¦ğŸ”";

            try {
                // v1beta ã‚’ä½¿ç”¨ã—ã€ã‚ˆã‚Šè©³ç´°ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼ã«ã—ã¾ã™
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            role: "user",
                            parts: [{ text: uttr }]
                        }],
                        system_instruction: { 
                            parts: [{ text: "å›ã¯å…ƒæ°—ãªãƒ”ãƒ³ã‚¯ã®çŒ«ã€ã´ã‚“ã«ã‚ƒã‚“ã€ã€‚ã²ãƒ¼ã¡ã‚ƒã‚“ã®è¦ªå‹ã€‚èªå°¾ã¯ã€ã«ã‚ƒï¼ã€ã€‚å°å­¦1å¹´ç”Ÿã«ã‚ã‹ã‚‹è¨€è‘‰ã§çŸ­ãç­”ãˆã¦ã€‚è£…é£¾æ–‡å­—ã¯ä½¿ã‚ãªã„ã€‚" }] 
                        }
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    // ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã‚’å…·ä½“çš„ã«ç”»é¢ã«å‡ºã™ã‚ˆã†ã«ã—ã¾ã—ãŸ
                    throw new Error(data.error ? data.error.message : "APIã‚¨ãƒ©ãƒ¼ã ã«ã‚ƒ");
                }

                if (data.candidates && data.candidates[0].content) {
                    const aiText = data.candidates[0].content.parts[0].text;
                    displayText.innerText = aiText;
                    const message = new SpeechSynthesisUtterance(aiText);
                    message.lang = 'ja-JP';
                    message.pitch = 1.6;
                    synth.speak(message);
                    statusText.innerText = "ã¾ãŸãŠè©±ã—ã‚ˆã†ã«ã‚ƒï¼";
                }
            } catch (error) {
                statusText.innerText = "ã”ã‚ã‚“ã­ã€ã‚¨ãƒ©ãƒ¼ã ã«ã‚ƒâ€¦";
                displayText.innerText = "ç†ç”±: " + error.message;
                console.error("Error details:", error);
            }
        };
    </script>
</body>
</html>
